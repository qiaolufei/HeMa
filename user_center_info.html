<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
	<title>喝吗鲜生-用户中心</title>
	<link rel="stylesheet" type="text/css" href="css/reset.css">
	<link rel="stylesheet" type="text/css" href="css/main.css">
	<script src="js/jquery-2.1.1.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
	<div class="header_con">
		<div class="header">
			<div class="welcome fl">欢迎来到喝吗鲜生!</div>
			<div class="fr">
				<div class="user_link fl" id="link_row">
					<a href="index.html">首页</a>
					<span>|</span>
					<a href="cart.html">我的购物车</a>
					<span>|</span>
					<a id="logout">注销</a>
					<!--注销窗口-->
					<div id="logout_window" style="display: none; margin:auto;top: 25%;left: 45%; width: 300px; height: 250px; background-color: rgba(0,0,0,0.5);z-index: 2;position: fixed;border:1px solid #e0e0e0; border-radius: 8px;">
						<ul style="margin: 10px;">
							<li style="text-align: center;"><span style="font-size: 14px;color: #fff;margin-top: 30px;">北极星工作室提醒您</span></li>
							<br/>
							<li style="text-align: center;margin-top: 10px;"><span style="font-size: 20px;color: #fff;margin-top: 30px;">是否注销</span></li>
							<br/>
							<li style="text-align: center;font-size: 14px;margin-top: 10px;">
								<input type="button" class="submit1" id="logout_yes" value="确认" style="width: 60px;height: 28px;background: #000000;opacity:0.5;border: 0px;outline: none;color: #fff;margin-right: 10px;"/>
								<input type="button" class="submit1" id="logout_cancel" value="取消" style="width: 60px;height: 28px;background: #000000;opacity:0.5;border: 0px;outline: none;color: #fff;margin-left: 10px;"/>
							</li>
							
						</ul>
					</div>
				</div>
			</div>
		</div>		
	</div>

	<div class="search_bar clearfix">
		<a href="index.html" class="logo fl"><img src="images/logo.jpg"></a>
		<div class="sub_page_name fl">|&nbsp;&nbsp;&nbsp;&nbsp;用户中心</div>
	</div>

	<div class="main_con clearfix">
		<div class="left_menu_con clearfix">
			<h3>用户中心</h3>
			<ul>
				<li><a href="user_center_info.html" class="active">· 个人信息</a></li>
				<li><a href="user_center_order.html">· 全部订单</a></li>
			</ul>
		</div>
		<div class="right_content clearfix">
				<div class="info_con clearfix">
				<h3 class="common_title2">基本信息</h3>
						<ul class="user_info_list">
							<li id="headpic"><span>头像：</span><img style="width:80px;height:80px;border-radius:40px;overflow: hidden;" src="images/goods.jpg"></li>
							<li id="nick"><span>昵称：</span><a>大石头</a></li>
							<li id="account"><span>账号：</span><a>18210569700</a></li>
							<li style="margin: 10px 0 0 80%;"><input type="button" class="edit-btu1" value="编辑" id="EditInfo" style="width: 80px;height: 20px;background: #f9f9f9;border: 0px;outline: none;"/>	</li>
						</ul>				
				</div>
				<!--编辑信息窗口-->
				<div id="editInfo" style="display: none; margin:auto;top: 25%;left: 45%; width: 300px; height: 250px; background-color: white;z-index: 2;position: fixed;border:1px solid #e0e0e0; border-radius: 8px;">
					<ul style="margin: 10px;">
						<li style="text-align: right;"><input type="button" id="closeEditInfo" value="X" style="width: 30px;height: 20px;background: white;border: 0px;"/></li>
						<br/>
						<li><span style="font-size: 14px;"></span><input type="text" id="new_nick" placeholder=" 昵称" style="width: 100%;height:30px;outline: none;border:0.5px solid #e0e0e0;background: #F8F8F8;"/></li>
						<br/>
						<li style="text-align: center;font-size: 14px;"><input type="button" class="submit1" id="submitnewId" value="提交" style="width: 80px;height: 20px;background: white;border: 0px;outline: none;"/></li>
					</ul>
				</div>	
				<div class="info_con clearfix">
				<h3 class="common_title2">收货地址</h3>
						<ul class="user_info_list">
							<li id="name"><span>姓名：</span><a>杨小凡</a></li>
							<li id="phone"><span>电话：</span><a>18540279973</a></li>
							<li id="addrs"><span>收货地址：</span><a>A2 111</a></li>
							<li style="margin: 10px 0 0 80%;"><input type="button" class="edit-btu2" value="修改" id="EditAddress" style="width: 80px;height: 20px;background: #f9f9f9;border: 0px;outline: none;"/></li>
						</ul>		
				</div>
				<!--编辑收货地址窗口-->
				<div id="editAddress" style="display: none;margin:auto;top: 25%;left: 45%;width: 300px; height: 250px; background-color: white;z-index: 2;position:fixed;border:1px solid #e0e0e0; border-radius: 8px ;">
					<ul style="margin: 10px;">
						<li style="text-align: right;"><input type="button" id="closeEditAddress" value="X" style="width: 30px;height: 20px;background: white;border: 0px;"/></li>
						<br/>
						<li><span style="font-size: 14px;"/><input type="text" id="new_name" placeholder=" 收货人姓名" style="width: 100%;height:30px;outline: none;border:0.5px solid #e0e0e0;background: #F8F8F8;"/></li>
						<br/>
						<li><span style="font-size: 14px;"/><input type="text" id="new_phone" placeholder=" 电话" style="width: 100%;height:30px;outline: none;border:0.5px solid #e0e0e0;background: #F8F8F8;"/></li>
						<br/>
						<li><span style="font-size: 14px;"/></span><input type="text" id="new_address" placeholder=" 收货地址" style="width: 100%;height:30px;outline: none;border:0.5px solid #e0e0e0;background: #F8F8F8;"/></li>
						<br/>
						<li style="text-align: center;font-size: 14px;"><input type="button" class="submit2" id="submitnewAd" value="提交" style="width: 80px;height: 20px;background: white;border: 0px;outline: none;"/></li>
					</ul>
				</div>	
		</div>
	</div>



	<div class="footer">
		<div class="foot_link">
			<a href="#">关于我们</a>
			<span>|</span>
			<a href="#">联系我们</a>
			<span>|</span>
			<a href="#">招聘人才</a>
			<span>|</span>
			<a href="#">友情链接</a>		
		</div>
		<p>CopyRight © 2019 沈工大北极星工作室 All Rights Reserved</p>
		<p>电话：010-****888    京ICP备*******8号</p>
	</div>
	
	<script type="text/javascript">
		var curruser;
		$(function(){
			$.ajax({
				type:"get",
				url:"http://localhost:8080/currUser",
				dataType:'json',
				async:true,
				xhrFields: {
					withCredentials: true
				},
				rossDomain: true,
				success:function(res){
					curruser=res.data; //获取当前用户对象
					if(res.data != null){
						$.ajax({
								type:"post",
								url:"http://localhost:8080/selectUser/"+curruser.username,
								dataType:'json',
								async:true,
								xhrFields: {
									withCredentials: true
								},
								rossDomain: true,
								success:function(res){
									if(res.data != null){
										var user=res.data;
										var len=user.username.length;
										$('.header_con .header .fr #login_row').hide();
										$('.header_con .header .fr #link_row #yonghuzhongxin').html(user.username.substring(0,3)+"***"+user.username.substring(len-3,len));
										
										//基本信息
										$('#headpic img').attr('src',user.headpic);
										$('#nick a').text(user.nickname);
										$('#account a').text(user.username);
										
										//收货地址
										$('#name a').text(user.name);
										$('#phone a').text(user.phone);
										$('#addrs a').text(user.address);
										
									}
								}
						 });
					}
				}
		    });
		})
		//编辑信息窗口
		$(document).ready(function() {
			$('#EditInfo').click(function() {
				$('#editInfo').toggle();
			});
		});
		//编辑地址窗口
		$(document).ready(function() {
			$('#EditAddress').click(function() {
				$('#editAddress').toggle();
			});
		});
		//注销窗口
		$(document).ready(function() {
			$('#logout').click(function() {
				//$(this).setAttribute("class","active");
				$('#logout_window').toggle();
			});
		});
		
		//关闭编辑信息窗口
		$(document).ready(function() {
			$('#closeEditInfo').click(function() {
				$('#editInfo').toggle();
			});
		});
		//关闭编辑地址窗口
		$(document).ready(function() {
			$('#closeEditAddress').click(function() {
				$('#editAddress').toggle();
			});
		});
		
		//点击提交修改信息后隐藏窗口
		$(document).ready(function() {
			$('#submitnewId').click(function() {
				if ($('#new_nick').val()=="") {
					alert("请输入昵称");
					return;
				}
				$.ajax({
					type:"POST",
					url:"http://localhost:8080/updateNick",
					data:JSON.stringify({
						'username':$('#account a').text(),
						'nickname':$('#new_nick').val()
					}),
					dataType:'json',
					async:true,
					contentType:"application/json; charset=utf-8",
					xhrFields: {
						withCredentials: true
					},
					success:function(res){
						if(res.data != 14){
							var user=res.data;
							$('#nick a').text(user.nickname);
						}else{
							alert("修改失败!");
						}
					}
				});
				$('#editInfo').toggle();
			});
		});
		$(document).ready(function() {
			$('#submitnewAd').click(function() {
				if ($('#new_address').val()=="" || $('#new_name').val()=="" || $('#new_phone').val()=="") {
					alert("请将收货信息补充完整 !");
					return;
				}
				$.ajax({
					type:"POST",
					url:"http://localhost:8080/updateAddress",
					data:JSON.stringify({
						'username':$('#account a').text(),
						'address':$('#new_address').val(),
						'name':$('#new_name').val(),
						'phone':$('#new_phone').val()
					}),
					dataType:'json',
					async:true,
					contentType:"application/json; charset=utf-8",
					xhrFields: {
						withCredentials: true
					},
					success:function(res){
						if(res.data != 14){
							var user=res.data;
							
							//收货地址
							$('#name a').text(user.name);
							$('#phone a').text(user.phone);
							$('#addrs a').text(user.address);
						}else{
							alert("修改失败!");
						}
					}
				});
				$('#editAddress').toggle();
			});
		});
		
		//确认注销
		$(document).ready(function(){
			$('#logout_yes').click(function(){
				$.ajax({
					type:"get",
					url:"http://localhost:8080/logOut",
					dataType:'json',
					async:true,
					xhrFields: {
						withCredentials: true
					},
					rossDomain: true,
					success:function(res){
						if(res.status === 200){
							alert("注销成功");
							location.href = "index.html";
						}else{
							alert("注销失败");
						}
					}
			    });
			    $('#logout_window').toggle();
			});
		});
		
		//取消注销
		$(document).ready(function(){
			$('#logout_cancel').click(function(){
			    $('#logout_window').toggle();
			});
		});
	
	</script>
	<style>
		.edit-btu1 ,.edit-btu2,.submit1,.submit2{
			position: relative;
			display: inline-block;
			background: #D0EEFF;
			border: 1px solid #99D3F5;
			border-radius: 4px;
			padding: 4px 12px;
			overflow: hidden;
			color: #1E88C7;
			text-decoration: none;
			text-indent: 0;
			line-height: 20px;
		}
		.edit-btu1:hover ,.edit-btu2:hover,.submit1:hover,.submit2:hover{
    		background: #AADFFD;
    		border-color: #78C3F3;
    		color: #004974;
    		text-decoration: none;
		}
	</style>
</body>
</html>